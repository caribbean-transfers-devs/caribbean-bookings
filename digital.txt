# OPTIMIZACIÓN ESPECÍFICA PARA LARAVEL
innodb_buffer_pool_size = 1G
innodb_log_file_size = 128M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# CONEXIONES
max_connections = 100
thread_cache_size = 16
wait_timeout = 300
interactive_timeout = 300

# PERFORMANCE
tmp_table_size = 128M
max_heap_table_size = 128M
max_allowed_packet = 256M

# LOGS PARA DEBUGGING
slow_query_log = 1
slow_query_log_file = /var/log/mysql/laravel-slow.log
long_query_time = 1

sudo apt install -y certbot python3-certbot-apache
sudo certbot --apache -d bookings.caribbeantransfers.tech

CONFIGURACIONES DE NUEVO SERVIDOR:

// CREAMOS LA BASE DE DATOS Y USUARIO LOCALHOST
    CREATE DATABASE transportation_api CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    CREATE USER 'caribbean_root'@'localhost' IDENTIFIED BY 'QQK8RCiBszsjqnH';
    GRANT ALL PRIVILEGES ON transportation_api.* TO 'caribbean_root'@'localhost';
    FLUSH PRIVILEGES;
    EXIT;

    USUARIO CON CONEXION REMOTA
    CREATE USER 'caribbean_remote'@'%' IDENTIFIED BY 'WVi85RatgvkM6YW';
    GRANT ALL PRIVILEGES ON transportation_api.* TO 'caribbean_remote'@'%';
    FLUSH PRIVILEGES;
    EXIT;

    PERMITIR MYSQL DESDE UNA IP:
    sudo ufw allow from 187.190.174.84 to any port 3306
    sudo ufw allow from 138.68.15.200 to any port 3306

    sudo systemctl restart mariadb

// INTALAMOS Y CONFIGURAMOS PHPMYADMIN
    sudo apt install -y phpmyadmin

    Usuario: admin
    Contraseña: QQK8RCiBszsjqnH

    sudo a2enconf phpmyadmin
    sudo systemctl reload apache2
    sudo systemctl restart apache2

// INSTALAMOS Y CONFIGURAMOS FTP
    adduser caribbean_root
    contraseña: QQK8RCiBszsjqnH
    sudo usermod -a -G www-data caribbean_root
    sudo chown -R www-data:www-data /var/www
    sudo chmod -R 775 /var/www

    //PROBLEMAS PARA CONECTAR POR FILEZILLA Y ME DA 2 OPCIONES PARA SOLUCIONARLO
    Opción 1 (Recomendada y Más Segura): Usar Clave SSH
    ssh-copy-id -i ~/.ssh/id_ed25519.pub caribbean_root@45.55.244.245
    Opción 2 (Menos Segura): Habilitar Autenticación por Contraseña en el Servidor SSH

Victor2020##@@,()

SI ACTIVO REGLA DE FIREWALL DE ESTA MANERA LO PUEDO ELIMINAR:
sudo ufw status verbose -> Verifica el estado de UFW:
sudo ufw disable -> Prueba desactivar UFW temporalmente:
sudo ufw delete allow from 100.64.0.9 to any port 3306
sudo ufw reload
sudo ufw status
sudo ufw status numbered. -> VALIDO ESTATUS

sudo ufw allow from 100.64.0.9 to any port 80,443,3306 proto tcp -> AGRAGA REGLA
sudo ufw delete allow from 100.64.0.9 to any port 80,443,3306 -> ELIMINO REGLA
cat ~/.ssh/authorized_keys -> VER MIS SSH

Habilita UFW con las reglas correctas:
sudo ufw allow 80/tcp     # HTTP
sudo ufw allow 443/tcp    # HTTPS
sudo ufw allow 22/tcp     # SSH (para no perder acceso remoto)
sudo ufw allow 20/tcp
sudo ufw allow 21/tcp
sudo ufw allow 40000:50000/tcp
sudo ufw enable





# DB_HOST=aws.connect.psdb.cloud

#PRUEBAS
# DB_DATABASE=transportation-api
# DB_USERNAME=6l03hrblyogcgscqkv35
# DB_PASSWORD=pscale_pw_Ldt5fPgBqKIWC8cCBWQEX3N21AhEJKABhggCOddzXiC

# PRODUCION
# DB_DATABASE=transportation-api
# DB_USERNAME=bjdl6g9bc7ntxke68hmv
# DB_PASSWORD=pscale_pw_MHdnWcPy9bQGaT02Z0fh18qRSZrVYcTv43uTXpytGq

# PRODUCION CON PERMISOS
# DB_DATABASE=transportation-api
# DB_USERNAME=x44ndy8dc4nbahupmyju
# DB_PASSWORD=pscale_pw_iBFqt1ozgAj7pd21Xise2U9UI5jONyVvYHXRy7p2vhB
# MYSQL_ATTR_SSL_CA=/etc/ssl/cert.pem




# DB_HOST="localhost"
# DB_DATABASE="transportation_api"
# DB_USERNAME="caribbean_root"
# DB_PASSWORD="QQK8RCiBszsjqnH"

# DESTINO_DB_HOST="82.197.82.72"
# DESTINO_DB_DATABASE="u635545471_transportation"
# DESTINO_DB_USERNAME="u635545471_transportation"
# DESTINO_DB_PASSWORD="7/wZ!UX[6aAq"

# //CONEXION ORIGINAL DEL CRM
#DB_HOST="aws.connect.psdb.cloud"
#DB_DATABASE="transportation-api"
#DB_USERNAME="bjdl6g9bc7ntxke68hmv"
#DB_PASSWORD="pscale_pw_MHdnWcPy9bQGaT02Z0fh18qRSZrVYcTv43uTXpytGq"
#MYSQL_ATTR_SSL_CA="/etc/ssl/certs/ca-certificates.crt"